<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Badminton Community</title>
		<style>
			body, html {
			height: 100%;
			width: 100%;
			padding: 0;
			margin: 20px 0 0 0;
			}
			#map {
				width: 100%;
				min-height: 100%;
			}
		</style>
	</head>
	<body>
		
		<div id="map">
			<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
			<script>
				function initMap() {

					// Set the center of the map to Décathlon Brossard
					var location = {lat: 45.4717, lng: -73.4718};
					var map = new google.maps.Map(document.getElementById('map'), {
						zoom: 11,
						center: location
					});
					
					// Sport Places API End Point					
					var url = 'https://sportplaces-api.herokuapp.com/api/v1/places?origin=-73.4718,45.4717&radius=99&sports=132'

					// Add the markets automatically
					map.data.loadGeoJson(url);
					
					var places = [];
					
					// API Call
					$.ajax({
						url: url,
						method: 'GET',
						dataType: 'JSON',
						data: {},
						success: function(data) {
							initInfoWindowsToMarkers(data.features)
						},
						error: function(err) {
							console.log('error:' + err)
						}
					})
					
					
					function initInfoWindowsToMarkers (places) {
						var placesObjects = places
						
						// Loop on all sport places retrieved
						//						
						for (i = 0; i < placesObjects.length; i++){
							createInfoWindow();
						}

						function createInfoWindow () {
							
							// Initiatize an empty marker
							var infowindow = new google.maps.InfoWindow({content: 'Loading...'});
								
							map.data.addListener('click', function(event) {
									var myHTML = constructHTMLPopUp(event.feature.f);
								    infowindow.setContent(myHTML);
								    infowindow.setPosition(event.feature.getGeometry().get());
								    infowindow.setOptions({pixelOffset: new google.maps.Size(0,-30)});
								    infowindow.open(map);
								});
							}

						function constructHTMLPopUp(sportPlace) {
							var HtmlString = '<div id="content" style="width:150px;">'+
												'<div id="siteNotice">'+
												'</div>'+
												'<h1 id="placeHeading" class="placeHeading">' + sportPlace.name + '</h1>'+
												'<div id="bodyContent">'+
														'<p>Phone: 450-679-6131 ' +
																'Address: 550 Boulevard Curé-Poirier Ouest, Longueuil '+
																'Québec, Canada '+
																'J4J 2H6'+
																'Website: <a href="complexesportiflongueuil.com/en/home/complexesportiflongueuil.com/en/home">complexesportiflongueuil.com/en/home/</a></p>'+
														'</div>'+
												'</div>';
							return HtmlString;
						}
					}
				}
				</script>
				<script async defer
					src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB88gtQGJZeD3uJ_74estIOyyIhR0Oq2TY&callback=initMap">
				</script>
				
			</div>
		</body>
	</html>